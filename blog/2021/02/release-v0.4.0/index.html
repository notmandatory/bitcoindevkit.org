

<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.79.0" />
    <meta name="description" content="Announcing the v0.4.0 release of BDK">
<meta name="author" content="Alekos Filini - @afilini">

    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
<link rel="manifest" href="/icons/site.webmanifest">
<link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

    <title>Release v0.4.0 :: Bitcoin Dev Kit</title>

    
    <link href="/css/nucleus.css?1619020486" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1619020486" rel="stylesheet">
    <link href="/css/hybrid.css?1619020486" rel="stylesheet">
    <link href="/css/featherlight.min.css?1619020486" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1619020486" rel="stylesheet">
    <link href="/css/auto-complete.css?1619020486" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1619020486" rel="stylesheet">
    <link href="/css/theme.css?1619020486" rel="stylesheet">
    <link href="/css/hugo-theme.css?1619020486" rel="stylesheet">
    
    <link href="/css/theme-blue.css?1619020486" rel="stylesheet">
    
    <link href="/css/style.css?1619020486" rel="stylesheet"><link href="/css/jsonview.css?1619020486" rel="stylesheet"><link href="/css/blog.css?1619020486" rel="stylesheet">

    <meta property="og:title" content="Release v0.4.0" />
<meta property="og:description" content="Announcing the v0.4.0 release of BDK" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bitcoindevkit.org/blog/2021/02/release-v0.4.0/" />
<meta property="og:image" content="https://bitcoindevkit.org/images/logo-wide.jpg"/>
<meta property="article:published_time" content="2021-02-17T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-02-17T00:00:00+00:00" />

    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://bitcoindevkit.org/images/logo-wide.jpg"/>

<meta name="twitter:title" content="Release v0.4.0"/>
<meta name="twitter:description" content="Announcing the v0.4.0 release of BDK"/>


    <script src="/js/jquery-3.3.1.min.js?1619020486"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/blog/2021/02/release-v0.4.0/">
    


<nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">
    <img src="/images/logo.svg" alt="Bitcoin Dev Kit logo"/>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1619020486"></script>
<script type="text/javascript" src="/js/auto-complete.js?1619020486"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/bitcoindevkit.org\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1619020486"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/blog/" title="Blog" class="dd-item
        parent
        
        
        ">
      <a href="/blog/">
          <i class="fas fa-newspaper"></i> Blog
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/bdk-cli/" title="BDK CLI" class="dd-item
        
        
        
        ">
      <a href="/bdk-cli/">
          <i class="fas fa-terminal"></i> BDK CLI
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/bdk-cli/installation/" title="Installation" class="dd-item ">
        <a href="/bdk-cli/installation/">
        <b>1. </b>Installation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/bdk-cli/concept/" title="Concept" class="dd-item ">
        <a href="/bdk-cli/concept/">
        <b>2. </b>Concept
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/bdk-cli/interface/" title="Interface" class="dd-item ">
        <a href="/bdk-cli/interface/">
        <b>3. </b>Interface
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/bdk-cli/regtest/" title="Regtest" class="dd-item ">
        <a href="/bdk-cli/regtest/">
        <b>4. </b>Regtest
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/bdk-cli/compiler/" title="Compiler" class="dd-item ">
        <a href="/bdk-cli/compiler/">
        <b>5. </b>Compiler
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/bdk-cli/playground/" title="Playground" class="dd-item ">
        <a href="/bdk-cli/playground/">
        <b>6. </b>Playground
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/descriptors/" title="Descriptors" class="dd-item
        
        
        
        ">
      <a href="/descriptors/">
          <i class="fas fa-code"></i> Descriptors
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/supporters/" title="Supporters" class="dd-item
        
        
        
        ">
      <a href="/supporters/">
          <i class="fas fa-heart"></i> Supporters
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://docs.rs/bdk"><i class='fas fa-book-open'></i> Stable Docs</a>
              </li>
          
              <li>
                  <a class="padding" href="https://bitcoindevkit.org/docs-rs/bdk/nightly/latest/bdk"><i class='fas fa-tools'></i> Nightly Docs</a>
              </li>
          
              <li>
                  <a class="padding" href="https://bitcoindevkit.org/bdk-cli/playground"><i class='fas fa-magic'></i> Playground</a>
              </li>
          
              <li>
                  <a class="padding" href="https://twitter.com/intent/follow?screen_name=bitcoindevkit"><i style='font-size: 20px' class='fab fa-twitter-square'></i> Follow on Twitter</a>
              </li>
          
              <li>
                  <a class="padding" href="https://discord.gg/dstn4dQ"><i style='font-size: 20px' class='fab fa-discord'></i> Chat on Discord</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <script type="text/javascript" src="/js/github-buttons.js"></script>

<center>
    
    <a class="github-button" href="https://github.com/bitcoindevkit/bdk/subscription" data-icon="octicon-eye" data-show-count="true" aria-label="Watch bitcoindevkit/bdk on GitHub">Watch</a>
    <a class="github-button" href="https://github.com/bitcoindevkit/bdk" data-icon="octicon-star" data-show-count="true" aria-label="Star bitcoindevkit/bdk on GitHub">Star</a>
    <a class="github-button" href="https://github.com/bitcoindevkit/bdk/fork" data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork bitcoindevkit/bdk on GitHub">Fork</a>
</center>

<center>Built with <a href="https://gohugo.io/">Hugo</a></center>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/bitcoindevkit/bitcoindevkit.org/edit/master/content/blog/2021/release-0.4.0.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                   Release v0.4.0
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#whats-new-in-v040">What&rsquo;s new in v0.4.0</a>
      <ul>
        <li><a href="#a-new-api-to-build-transaction">A new API to build transaction</a></li>
        <li><a href="#upgraded-dependencies">Upgraded dependencies</a></li>
        <li><a href="#compact-filters-example">Compact Filters example</a></li>
      </ul>
    </li>
    <li><a href="#contributors">Contributors</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        


<div class="tags">

  <a class="tag-link" href="/blog/tags/rust">rust</a>

  <a class="tag-link" href="/blog/tags/release">release</a>

</div>


        </div>
        
        <div id="body-inner">
          
            
            <h1 class="blog-title">Release v0.4.0 </h1>
            
                <span class="blog-author">By </span><span class="blog-author"><a href="/authors/alekos-filini">Alekos Filini</a></span>
            
            
          

        


<p>A new release of BDK is out: the <a href="https://crates.io/crates/bdk/0.4.0"><code>v0.4.0</code></a> release brings updated dependencies, more sanity checks and an overhauled API to build transactions.</p>
<p>You can find the full <a href="https://github.com/bitcoindevkit/bdk/blob/5e352489a0ac9dd92002a73aa64789a9ae2f0794/CHANGELOG.md#v040---v030">v0.4.0 changelog</a> on GitHub.</p>
<h2 id="whats-new-in-v040">What&rsquo;s new in v0.4.0</h2>
<p>Below are some highlights of the new improved APIs coming with this release:</p>
<h3 id="a-new-api-to-build-transaction">A new API to build transaction</h3>
<p>The star of this release is the new API designed and implemented by <a href="https://github.com/llfourn">@llfourn</a> that brings much more flexibility to the way we create transactions: originally the process of making a transaction involved the creation of a <code>TxBuilder</code> which was used
to configure <em>how</em> the wallet should build the transaction. Things like which outputs to create, what <code>nLockTime</code> to use, which UTXOs to spend, and much more.</p>
<p>Once fully configured, this builder was then given to the <code>Wallet</code> itself in a <code>Wallet::create_tx()</code> or <code>Wallet::bump_fee()</code> call: the <code>Wallet</code> would try to follow the <em>instructions</em> given by the builder, but in
case of conflicting or straight-up wrong options it would have to fail and force the user to start over.</p>
<p>The new API maintains the concept of a <em>builder</em>, but it changes the way it&rsquo;s created so that it always contains a reference to the main <code>Wallet</code> instance. What this means is that most checks can now be performed right
when something is added to the builder, not at the end, allowing the user to recover from errors instead of having to start over.</p>
<p>This also opens the door to even more improvements and additions, such as a way to <a href="https://github.com/bitcoindevkit/bdk/pull/279">spend foreign utxos</a> in a transaction, or even a way to <a href="https://github.com/bitcoindevkit/bdk/issues/280">bump the fees of multiple transactions at once</a> by batching them together, which
saves a bit of space and money.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#66d9ef">let</span> send_to <span style="color:#f92672">=</span> wallet.get_new_address()<span style="color:#f92672">?</span>;
<span style="color:#66d9ef">let</span> (psbt, details) <span style="color:#f92672">=</span> {
    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> builder <span style="color:#f92672">=</span> wallet.build_tx();
    builder
        .add_recipient(send_to.script_pubkey(), <span style="color:#ae81ff">50_000</span>)
        .enable_rbf()
        .do_not_spend_change()
        .fee_rate(FeeRate::from_sat_per_vb(<span style="color:#ae81ff">5.0</span>));
    builder.finish()<span style="color:#f92672">?</span>
};
</code></pre></div><h3 id="upgraded-dependencies">Upgraded dependencies</h3>
<p>This release also brings many updates to our dependencies, including:</p>
<ul>
<li><code>bitcoin</code> to <code>v0.26</code></li>
<li><code>miniscript</code> to <code>v5.1</code></li>
<li><code>electrum-client</code> to <code>v0.6</code></li>
<li><code>tokio</code> to <code>v1</code></li>
<li><code>reqwest</code> to <code>v0.11</code></li>
<li><code>cc</code> to <code>&gt;= v1.0.64</code></li>
</ul>
<h3 id="compact-filters-example">Compact Filters example</h3>
<p>Thanks to the upgrade to <code>bitcoin v0.26</code> all the issues related to new networking messages in the P2P Bitcoin network have been fixed, which means that we can finally use our (experimental) compact filters <code>Blockchain</code> with
standard Bitcoin Core 0.21 full nodes.</p>
<p>The following example has also been added to the repository and can be run with <code>cargo run --features=compact_filters --example compact_filters_balance</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#e6db74">/// This will return wallet balance using compact filters
</span><span style="color:#e6db74">/// Requires a synced local bitcoin node 0.21 running on testnet with blockfilterindex=1 and peerblockfilters=1
</span><span style="color:#e6db74"></span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() -&gt; Result<span style="color:#f92672">&lt;</span>(), CompactFiltersError<span style="color:#f92672">&gt;</span> {
    env_logger::init();
    info<span style="color:#f92672">!</span>(<span style="color:#e6db74">&#34;start&#34;</span>);

    <span style="color:#66d9ef">let</span> num_threads <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>;
    <span style="color:#66d9ef">let</span> mempool <span style="color:#f92672">=</span> Arc::new(Mempool::default());
    <span style="color:#66d9ef">let</span> peers <span style="color:#f92672">=</span> (<span style="color:#ae81ff">0</span>..num_threads)
        .map(<span style="color:#f92672">|</span>_<span style="color:#f92672">|</span> Peer::connect(<span style="color:#e6db74">&#34;localhost:18333&#34;</span>, Arc::clone(<span style="color:#f92672">&amp;</span>mempool), Network::Testnet))
        .collect::<span style="color:#f92672">&lt;</span>Result<span style="color:#f92672">&lt;</span>_, _<span style="color:#f92672">&gt;&gt;</span>()<span style="color:#f92672">?</span>;
    <span style="color:#66d9ef">let</span> blockchain <span style="color:#f92672">=</span> CompactFiltersBlockchain::new(peers, <span style="color:#e6db74">&#34;./wallet-filters&#34;</span>, Some(<span style="color:#ae81ff">500_000</span>))<span style="color:#f92672">?</span>;
    info<span style="color:#f92672">!</span>(<span style="color:#e6db74">&#34;done {:?}&#34;</span>, blockchain);
    <span style="color:#66d9ef">let</span> descriptor <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;wpkh(tpubD6NzVbkrYhZ4X2yy78HWrr1M9NT8dKeWfzNiQqDdMqqa9UmmGztGGz6TaLFGsLfdft5iu32gxq1T4eMNxExNNWzVCpf9Y6JZi5TnqoC9wJq/*)&#34;</span>;

    <span style="color:#66d9ef">let</span> database <span style="color:#f92672">=</span> MemoryDatabase::default();
    <span style="color:#66d9ef">let</span> wallet <span style="color:#f92672">=</span>
        Arc::new(Wallet::new(descriptor, None, Network::Testnet, database, blockchain).unwrap());
    wallet.sync(noop_progress(), None).unwrap();
    info<span style="color:#f92672">!</span>(<span style="color:#e6db74">&#34;balance: {}&#34;</span>, wallet.get_balance()<span style="color:#f92672">?</span>);
    Ok(())
}
</code></pre></div><h2 id="contributors">Contributors</h2>
<p>A huge thanks to everybody who contributed to this new release with suggestions, pull requests and bug reports.</p>
<p>Since the <code>v0.3.0</code> release around a month ago, we&rsquo;ve had <code>59</code> new commits made by <code>8</code> different contributors for a total of <code>2463</code> additions and <code>1991</code> deletions. Here&rsquo;s the <a href="https://github.com/bitcoindevkit/bdk/compare/v0.3.0...v0.4.0">full diff</a>.</p>
<p>A special thanks to the new contributor for this release:</p>
<ul>
<li><a href="https://github.com/luckysori">@luckysori</a> - Lucas Soriano</li>
</ul>


<footer class="footline">
	
</footer>

        
        </div>
        

<script src="https://utteranc.es/client.js"
        repo="bitcoindevkit/blog-comments"
        issue-term="pathname"
        label="blog-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>



      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1619020486"></script>
    <script src="/js/perfect-scrollbar.min.js?1619020486"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1619020486"></script>
    <script src="/js/jquery.sticky.js?1619020486"></script>
    <script src="/js/featherlight.min.js?1619020486"></script>
    <script src="/js/highlight.pack.js?1619020486"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1619020486"></script>
    <script src="/js/learn.js?1619020486"></script>
    <script src="/js/hugo-learn.js?1619020486"></script>
    
        
            <script src="/mermaid/mermaid.js?1619020486"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    <script type="text/javascript" src="/js/jsonview.js" charset="utf-8"></script>
<script type="text/javascript" src="/js/main.js" charset="utf-8"></script>

  </body>
</html>

