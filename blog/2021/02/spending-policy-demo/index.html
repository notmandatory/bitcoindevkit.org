

<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.79.0" />
    <meta name="description" content="Demonstrate how to use a descriptor wallet with different spending policies">
<meta name="author" content="Alekos Filini - @afilini">

    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
<link rel="manifest" href="/icons/site.webmanifest">
<link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

    <title>Spending Policy Demo :: Bitcoin Dev Kit</title>

    
    <link href="/css/nucleus.css?1621379878" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1621379878" rel="stylesheet">
    <link href="/css/hybrid.css?1621379878" rel="stylesheet">
    <link href="/css/featherlight.min.css?1621379878" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1621379878" rel="stylesheet">
    <link href="/css/auto-complete.css?1621379878" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1621379878" rel="stylesheet">
    <link href="/css/theme.css?1621379878" rel="stylesheet">
    <link href="/css/hugo-theme.css?1621379878" rel="stylesheet">
    
    <link href="/css/theme-blue.css?1621379878" rel="stylesheet">
    
    <link href="/css/style.css?1621379878" rel="stylesheet"><link href="/css/jsonview.css?1621379878" rel="stylesheet"><link href="/css/blog.css?1621379878" rel="stylesheet">

    <meta property="og:title" content="Spending Policy Demo" />
<meta property="og:description" content="Demonstrate how to use a descriptor wallet with different spending policies" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bitcoindevkit.org/blog/2021/02/spending-policy-demo/" />
<meta property="og:image" content="https://bitcoindevkit.org/images/logo-wide.jpg"/>
<meta property="article:published_time" content="2021-02-23T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-02-23T00:00:00+00:00" />

    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://bitcoindevkit.org/images/logo-wide.jpg"/>

<meta name="twitter:title" content="Spending Policy Demo"/>
<meta name="twitter:description" content="Demonstrate how to use a descriptor wallet with different spending policies"/>


    <script src="/js/jquery-3.3.1.min.js?1621379878"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/blog/2021/02/spending-policy-demo/">
    


<nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">
    <img src="/images/logo.svg" alt="Bitcoin Dev Kit logo"/>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1621379878"></script>
<script type="text/javascript" src="/js/auto-complete.js?1621379878"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/bitcoindevkit.org\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1621379878"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/blog/" title="Blog" class="dd-item
        parent
        
        
        ">
      <a href="/blog/">
          <i class="fas fa-newspaper"></i> Blog
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/bdk-cli/" title="BDK CLI" class="dd-item
        
        
        
        ">
      <a href="/bdk-cli/">
          <i class="fas fa-terminal"></i> BDK CLI
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/bdk-cli/installation/" title="Installation" class="dd-item ">
        <a href="/bdk-cli/installation/">
        <b>1. </b>Installation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/bdk-cli/concept/" title="Concept" class="dd-item ">
        <a href="/bdk-cli/concept/">
        <b>2. </b>Concept
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/bdk-cli/interface/" title="Interface" class="dd-item ">
        <a href="/bdk-cli/interface/">
        <b>3. </b>Interface
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/bdk-cli/regtest/" title="Regtest" class="dd-item ">
        <a href="/bdk-cli/regtest/">
        <b>4. </b>Regtest
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/bdk-cli/compiler/" title="Compiler" class="dd-item ">
        <a href="/bdk-cli/compiler/">
        <b>5. </b>Compiler
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/bdk-cli/playground/" title="Playground" class="dd-item ">
        <a href="/bdk-cli/playground/">
        <b>6. </b>Playground
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/descriptors/" title="Descriptors" class="dd-item
        
        
        
        ">
      <a href="/descriptors/">
          <i class="fas fa-code"></i> Descriptors
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/supporters/" title="Supporters" class="dd-item
        
        
        
        ">
      <a href="/supporters/">
          <i class="fas fa-heart"></i> Supporters
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://docs.rs/bdk"><i class='fas fa-book-open'></i> Stable Docs</a>
              </li>
          
              <li>
                  <a class="padding" href="https://bitcoindevkit.org/docs-rs/bdk/nightly/latest/bdk"><i class='fas fa-tools'></i> Nightly Docs</a>
              </li>
          
              <li>
                  <a class="padding" href="https://bitcoindevkit.org/bdk-cli/playground"><i class='fas fa-magic'></i> Playground</a>
              </li>
          
              <li>
                  <a class="padding" href="https://twitter.com/intent/follow?screen_name=bitcoindevkit"><i style='font-size: 20px' class='fab fa-twitter-square'></i> Follow on Twitter</a>
              </li>
          
              <li>
                  <a class="padding" href="https://discord.gg/dstn4dQ"><i style='font-size: 20px' class='fab fa-discord'></i> Chat on Discord</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <script type="text/javascript" src="/js/github-buttons.js"></script>

<center>
    
    <a class="github-button" href="https://github.com/bitcoindevkit/bdk/subscription" data-icon="octicon-eye" data-show-count="true" aria-label="Watch bitcoindevkit/bdk on GitHub">Watch</a>
    <a class="github-button" href="https://github.com/bitcoindevkit/bdk" data-icon="octicon-star" data-show-count="true" aria-label="Star bitcoindevkit/bdk on GitHub">Star</a>
    <a class="github-button" href="https://github.com/bitcoindevkit/bdk/fork" data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork bitcoindevkit/bdk on GitHub">Fork</a>
</center>

<center>Built with <a href="https://gohugo.io/">Hugo</a></center>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/bitcoindevkit/bitcoindevkit.org/edit/master/content/blog/2021/spending_policy_demo.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                   Spending Policy Demo
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#initial-setup">Initial Setup</a>
      <ul>
        <li><a href="#step-0-install-a-recent-version-bdk-cli">Step 0: Install a recent version <code>bdk-cli</code></a></li>
        <li><a href="#step-1-generate-private-extended-keys">Step 1: Generate private extended keys</a></li>
        <li><a href="#step-2-extract-private-extended-keys">Step 2: Extract private extended keys</a></li>
        <li><a href="#step-3-derive-public-extended-keys">Step 3: Derive public extended keys</a></li>
        <li><a href="#step-4-create-wallet-descriptors-for-each-participant">Step 4: Create wallet descriptors for each participant</a></li>
      </ul>
    </li>
    <li><a href="#policy-a-three-signatures">Policy A. Three signatures</a>
      <ul>
        <li><a href="#step-1a-create-a-testnet-segwit0httpsenbitcoinitwikisegregated_witness-receive-address">Step 1a: Create a testnet <a href="https://en.bitcoin.it/wiki/Segregated_Witness">segwit0</a> receive address</a></li>
        <li><a href="#step-2a-send-testnet-bitcoin-from-a-faucet-to-receive-address">Step 2a: Send testnet bitcoin from a faucet to receive address</a></li>
        <li><a href="#step-3a-sync-participant-wallets-and-confirm-balance">Step 3a: Sync participant wallets and confirm balance</a></li>
        <li><a href="#step-4a-view-wallet-spending-policies">Step 4a: View wallet spending policies</a></li>
        <li><a href="#step-5a-create-spending-transaction">Step 5a: Create spending transaction</a></li>
        <li><a href="#step-6a-sign-and-finalize-psbts">Step 6a: Sign and finalize PSBTs</a></li>
        <li><a href="#step-7a-broadcast-finalized-psbt">Step 7a: Broadcast finalized PSBT</a></li>
        <li><a href="#step-8a-confirm-transaction-included-in-a-testnet-block">Step 8a: Confirm transaction included in a testnet block</a></li>
        <li><a href="#done">DONE!</a></li>
      </ul>
    </li>
    <li><a href="#policy-b-two-signatures-after-a-relative-time-lock">Policy B. Two signatures after a relative time lock</a>
      <ul>
        <li><a href="#step-1b-create-a-new-testnet-receive-address">Step 1b: Create a new testnet receive address</a></li>
        <li><a href="#step-2b-fund-new-address-from-testnet-faucet">Step 2b: Fund new address from testnet faucet</a></li>
        <li><a href="#step-3b-sync-wallet-and-confirm-wallet-balance">Step 3b: Sync wallet and confirm wallet balance</a></li>
        <li><a href="#step-4b-create-spending-transaction">Step 4b: Create spending transaction</a></li>
        <li><a href="#step-5b-sign-and-finalize-psbts">Step 5b: Sign and finalize PSBTs</a></li>
        <li><a href="#step-6b-broadcast-finalized-psbt">Step 6b: Broadcast finalized PSBT</a></li>
        <li><a href="#step-7b-view-confirmed-transaction">Step 7b: View confirmed transaction</a></li>
        <li><a href="#done-again">Done again!</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        


<div class="tags">

  <a class="tag-link" href="/blog/tags/guide">guide</a>

  <a class="tag-link" href="/blog/tags/descriptor">descriptor</a>

</div>


        </div>
        
        <div id="body-inner">
          
            
            <h1 class="blog-title">Spending Policy Demo </h1>
            
                <span class="blog-author">By </span><span class="blog-author"><a href="/authors/steve-myers">Steve Myers</a></span><span class="blog-author">, </span><span class="blog-author"><a href="/authors/thunderbiscuit">Thunderbiscuit</a></span>
            
            
          

        


<p>In this post we will use the <a href="https://github.com/bitcoindevkit/bdk-cli">bdk-cli</a> tool to demonstrate how to use the <a href="https://github.com/bitcoindevkit/bdk">bdk</a> library to:</p>
<ol>
<li>generate <em>testnet</em> public and private keys</li>
<li>create <a href="https://bitcoinops.org/en/topics/psbt/">PSBT</a>s that can be spent based on different <a href="http://bitcoin.sipa.be/miniscript/">miniscript spending policies</a></li>
<li>cooperatively sign and finalize the resulting PSBTs</li>
<li>broadcast and confirm spending transactions</li>
</ol>
<p>The scenario we will simulate is a wallet with two spending policies:</p>
<p>A. <strong>three</strong> out of <strong>three</strong> signers must sign spending transaction input <a href="https://developer.bitcoin.org/glossary.html">UTXO</a>s, <strong>OR</strong></p>
<p>B. <strong>two</strong> out of <strong>three</strong> signers must sign <strong>AND</strong> the input UTXOs must be a relative number of blocks older than the spending transaction&rsquo;s block</p>
<p>In a real-world wallet a longer relative time-lock would probably be used, but we chose a two block time-lock to make testing easier.</p>
<p><em>Note: If you repeat these instructions on your own your extended keys, addresses, and other values will be different than shown in this post, but the end results should be the same.</em></p>
<h2 id="initial-setup">Initial Setup</h2>
<h3 id="step-0-install-a-recent-version-bdk-cli">Step 0: Install a recent version <code>bdk-cli</code></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cargo install bdk-cli --features repl,electrum,esplora

<span style="color:#75715e"># confirm bdk-cli is installed</span>
bdk-cli --version
BDK CLI 0.2.0

<span style="color:#75715e"># bdk-cli usage can be explored with the `help` sub-command</span>
bdk-cli help
</code></pre></div><h3 id="step-1-generate-private-extended-keys">Step 1: Generate private extended keys</h3>
<p>Generate new extended private keys for each of our wallet participants:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bdk-cli key generate | tee alice-key.json
<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;fingerprint&#34;</span>: <span style="color:#e6db74">&#34;5adb4683&#34;</span>,
  <span style="color:#e6db74">&#34;mnemonic&#34;</span>: <span style="color:#e6db74">&#34;witness poverty pulse crush era item game rose bargain quantum spawn sure way behave also basket journey worry stem entry toddler floor way bone&#34;</span>,
  <span style="color:#e6db74">&#34;xprv&#34;</span>: <span style="color:#e6db74">&#34;tprv8ZgxMBicQKsPeAuGznXJZwfWHgWo86dFuufRBZN7ZT44UzoNG2cYmZLNLrnsm7eXhGSeccRU2nTtxunT11UkpqrRhJQefBnFJeHBddF68bg&#34;</span>
<span style="color:#f92672">}</span>

bdk-cli key generate | tee bob-key.json
<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;fingerprint&#34;</span>: <span style="color:#e6db74">&#34;5fdec309&#34;</span>,
  <span style="color:#e6db74">&#34;mnemonic&#34;</span>: <span style="color:#e6db74">&#34;shiver atom february jealous spy gallery upset height captain snake tooth master ugly orbit amazing nice parrot elevator own olympic great relief ozone violin&#34;</span>,
  <span style="color:#e6db74">&#34;xprv&#34;</span>: <span style="color:#e6db74">&#34;tprv8ZgxMBicQKsPei56wJPNt9u2132Ynncp2qXdfSHszobnyjaGjQwxQBGASUidc1unmEmpyMQ9XzLgvbN36MDW7LNziVFdXVGMrx6ckMHuRmd&#34;</span>
<span style="color:#f92672">}</span>

bdk-cli key generate | tee carol-key.json
<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;fingerprint&#34;</span>: <span style="color:#e6db74">&#34;de41e56d&#34;</span>,
  <span style="color:#e6db74">&#34;mnemonic&#34;</span>: <span style="color:#e6db74">&#34;upon bridge side tool style lounge need faculty middle nation armed corn valve that undo ribbon rent digital adapt capable embody zero shiver carpet&#34;</span>,
  <span style="color:#e6db74">&#34;xprv&#34;</span>: <span style="color:#e6db74">&#34;tprv8ZgxMBicQKsPf2edJLnXsF2AKwkCshCy2Z7fQD6FxiNVGsbkvpLRfxM8FSKrLqqpLFzLzVUBwgE9F5MQASrbedKCrGk1NG8oJgqYtmTLQEU&#34;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="step-2-extract-private-extended-keys">Step 2: Extract private extended keys</h3>
<p>Here we use the <code>jq</code> Unix command to parse the json output of the <code>bdk-cli</code> commands.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">export ALICE_XPRV<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>cat alice-key.json | jq -r <span style="color:#e6db74">&#39;.xprv&#39;</span><span style="color:#66d9ef">)</span>

export BOB_XPRV<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>cat bob-key.json | jq -r <span style="color:#e6db74">&#39;.xprv&#39;</span><span style="color:#66d9ef">)</span>

export CAROL_XPRV<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>cat carol-key.json | jq -r <span style="color:#e6db74">&#39;.xprv&#39;</span><span style="color:#66d9ef">)</span>
</code></pre></div><h3 id="step-3-derive-public-extended-keys">Step 3: Derive public extended keys</h3>
<p>For this example we are using the <a href="https://github.com/bitcoin/bips/blob/master/bip-0084.mediawiki">BIP-84</a> key path: <code>m/84h/1h/0h/0/*</code> to derive extended public keys to share with other wallet participants.</p>
<p>Note that the <code>key derive</code> sub-command will generate a tpub for the last hardened node in the given derivation path. You&rsquo;ll also notice that <code>bdk-cli</code> will returns our tpub with the key origin (fingerprint/path) added to it (the metadata part that looks like <code>[5adb4683/84'/1'/0']</code> right before the tpub). This key origin information is not necessary in order to use a tpub and generate addresses, but it&rsquo;s good practice to include it because some signers require it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">export ALICE_XPUB<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>bdk-cli key derive --xprv $ALICE_XPRV --path <span style="color:#e6db74">&#34;m/84&#39;/1&#39;/0&#39;/0&#34;</span> | jq -r <span style="color:#e6db74">&#34;.xpub&#34;</span><span style="color:#66d9ef">)</span>
echo <span style="color:#ae81ff">\&#34;</span>$ALICE_XPUB<span style="color:#ae81ff">\&#34;</span>
<span style="color:#e6db74">&#34;[5adb4683/84&#39;/1&#39;/0&#39;]tpubDCyRBuncqwyAjSNiw1GWLmwQsWyhgPMEBpx3ZNpnCwZwf3HXerspTpaneN81KRxkwj8vjqH9pNWEPgNhen7dfE212SHfxBBbsCywxQGxvvu/0/*&#34;</span>

export BOB_XPUB<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>bdk-cli key derive --xprv $BOB_XPRV --path <span style="color:#e6db74">&#34;m/84&#39;/1&#39;/0&#39;/0&#34;</span> | jq -r <span style="color:#e6db74">&#34;.xpub&#34;</span><span style="color:#66d9ef">)</span>
echo <span style="color:#ae81ff">\&#34;</span>$BOB_XPUB<span style="color:#ae81ff">\&#34;</span>
<span style="color:#e6db74">&#34;[5fdec309/84&#39;/1&#39;/0&#39;]tpubDDQcUeBH9JFtgZEsHZBhmRu8AuZ8ceJY1umnipPVEg1had2coGMCWdFBXNnZWKoCPic3EMgDZTdmkAVNoakwNZu2ESSW36rQvts6VXGx4bU/0/*&#34;</span>

export CAROL_XPUB<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>bdk-cli key derive --xprv $CAROL_XPRV --path <span style="color:#e6db74">&#34;m/84&#39;/1&#39;/0&#39;/0&#34;</span> | jq -r <span style="color:#e6db74">&#34;.xpub&#34;</span><span style="color:#66d9ef">)</span>
echo <span style="color:#ae81ff">\&#34;</span>$CAROL_XPUB<span style="color:#ae81ff">\&#34;</span>
<span style="color:#e6db74">&#34;[de41e56d/84&#39;/1&#39;/0&#39;]tpubDCdxmvzJ5QBjTN8oCjjyT2V58AyZvA1fkmCeZRC75QMoaHcVP2m45Bv3hmnR7ttAwkb2UNYyoXdHVt4gwBqRrJqLUU2JrM43HippxiWpHra/0/*&#34;</span>
</code></pre></div><h3 id="step-4-create-wallet-descriptors-for-each-participant">Step 4: Create wallet descriptors for each participant</h3>
<p>We used the <a href="https://bitcoindevkit.org/bdk-cli/playground/">BDK Playground Policy Compiler</a> to compile the <a href="http://bitcoin.sipa.be/miniscript/">miniscript</a> policy:</p>
<p><code>thresh(3,pk(Alice),pk(Bob),pk(Carol),older(2))</code></p>
<p>To the <a href="https://bitcoindevkit.org/descriptors/">output descriptor</a>:</p>
<p><code>wsh(thresh(3,pk(Alice),s:pk(Bob),s:pk(Carol),sdv:older(2)))</code></p>
<p>This descriptor requires spending transaction inputs must be signed by all three signers, or by two signers and the spent UTXOs must be older than two blocks.</p>
<p>Each participant&rsquo;s descriptor only uses their own XPRV key plus the XPUB keys of the other participants.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">export ALICE_DESCRIPTOR<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;wsh(thresh(3,pk(</span>$ALICE_XPRV<span style="color:#e6db74">/84&#39;/1&#39;/0&#39;/0/*),s:pk(</span>$BOB_XPUB<span style="color:#e6db74">),s:pk(</span>$CAROL_XPUB<span style="color:#e6db74">),sdv:older(2)))&#34;</span>

export BOB_DESCRIPTOR<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;wsh(thresh(3,pk(</span>$ALICE_XPUB<span style="color:#e6db74">),s:pk(</span>$BOB_XPRV<span style="color:#e6db74">/84&#39;/1&#39;/0&#39;/0/*),s:pk(</span>$CAROL_XPUB<span style="color:#e6db74">),sdv:older(2)))&#34;</span> 

export CAROL_DESCRIPTOR<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;wsh(thresh(3,pk(</span>$ALICE_XPUB<span style="color:#e6db74">),s:pk(</span>$BOB_XPUB<span style="color:#e6db74">),s:pk(</span>$CAROL_XPRV<span style="color:#e6db74">/84&#39;/1&#39;/0&#39;/0/*),sdv:older(2)))&#34;</span>
</code></pre></div><h2 id="policy-a-three-signatures">Policy A. Three signatures</h2>
<h3 id="step-1a-create-a-testnet-segwit0httpsenbitcoinitwikisegregated_witness-receive-address">Step 1a: Create a testnet <a href="https://en.bitcoin.it/wiki/Segregated_Witness">segwit0</a> receive address</h3>
<p>This step can be done independently by Alice, Bob, or Carol.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bdk-cli wallet -w carol -d $CAROL_DESCRIPTOR get_new_address
<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;address&#34;</span>: <span style="color:#e6db74">&#34;tb1qpqglt6yntay0se5vj3a7g36rql5pyzzp0w6jknfch2c0unwphsxs22g96e&#34;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="step-2a-send-testnet-bitcoin-from-a-faucet-to-receive-address">Step 2a: Send testnet bitcoin from a faucet to receive address</h3>
<p>After a faucet payment is sent, use a testnet block explorer to confirm the transaction was included in a block.</p>
<p><a href="https://mempool.space/testnet/address/tb1qpqglt6yntay0se5vj3a7g36rql5pyzzp0w6jknfch2c0unwphsxs22g96e">https://mempool.space/testnet/address/tb1qpqglt6yntay0se5vj3a7g36rql5pyzzp0w6jknfch2c0unwphsxs22g96e</a></p>
<h3 id="step-3a-sync-participant-wallets-and-confirm-balance">Step 3a: Sync participant wallets and confirm balance</h3>
<p>This step must be done by Alice, Bob, and Carol so their individual descriptor wallets know about the faucet transaction they will later be spending the output of.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bdk-cli wallet -w alice -d $ALICE_DESCRIPTOR sync       
<span style="color:#f92672">{}</span>
bdk-cli wallet -w alice -d $ALICE_DESCRIPTOR get_balance
<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;satoshi&#34;</span>: <span style="color:#ae81ff">10000</span>
<span style="color:#f92672">}</span>

bdk-cli wallet -w bob -d $BOB_DESCRIPTOR sync       
<span style="color:#f92672">{}</span>
bdk-cli wallet -w bob -d $BOB_DESCRIPTOR get_balance
<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;satoshi&#34;</span>: <span style="color:#ae81ff">10000</span>
<span style="color:#f92672">}</span>

bdk-cli wallet -w carol -d $CAROL_DESCRIPTOR sync       
<span style="color:#f92672">{}</span>
bdk-cli wallet -w carol -d $CAROL_DESCRIPTOR get_balance
<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;satoshi&#34;</span>: <span style="color:#ae81ff">10000</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="step-4a-view-wallet-spending-policies">Step 4a: View wallet spending policies</h3>
<p>This can also be done by any wallet participant, as long as they have the same descriptor and extended public keys from the other particpants..</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bdk-cli wallet -w alice -d $ALICE_DESCRIPTOR policies
<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;external&#34;</span>: <span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;contribution&#34;</span>: <span style="color:#f92672">{</span>
      <span style="color:#e6db74">&#34;conditions&#34;</span>: <span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;0&#34;</span>: <span style="color:#f92672">[</span>
          <span style="color:#f92672">{}</span>
        <span style="color:#f92672">]</span>,
        <span style="color:#e6db74">&#34;3&#34;</span>: <span style="color:#f92672">[</span>
          <span style="color:#f92672">{</span>
            <span style="color:#e6db74">&#34;csv&#34;</span>: <span style="color:#ae81ff">2</span>
          <span style="color:#f92672">}</span>
        <span style="color:#f92672">]</span>
      <span style="color:#f92672">}</span>,
      <span style="color:#e6db74">&#34;items&#34;</span>: <span style="color:#f92672">[</span>
        0,
        <span style="color:#ae81ff">3</span>
      <span style="color:#f92672">]</span>,
      <span style="color:#e6db74">&#34;m&#34;</span>: 3,
      <span style="color:#e6db74">&#34;n&#34;</span>: 4,
      <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;PARTIAL&#34;</span>
    <span style="color:#f92672">}</span>,
    <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;ydtnup84&#34;</span>,
    <span style="color:#e6db74">&#34;items&#34;</span>: <span style="color:#f92672">[</span>
      <span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;contribution&#34;</span>: <span style="color:#f92672">{</span>
          <span style="color:#e6db74">&#34;condition&#34;</span>: <span style="color:#f92672">{}</span>,
          <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;COMPLETE&#34;</span>
        <span style="color:#f92672">}</span>,
        <span style="color:#e6db74">&#34;fingerprint&#34;</span>: <span style="color:#e6db74">&#34;5adb4683&#34;</span>,
        <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;uyxvyzqt&#34;</span>,
        <span style="color:#e6db74">&#34;satisfaction&#34;</span>: <span style="color:#f92672">{</span>
          <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;NONE&#34;</span>
        <span style="color:#f92672">}</span>,
        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;SIGNATURE&#34;</span>
      <span style="color:#f92672">}</span>,
      <span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;contribution&#34;</span>: <span style="color:#f92672">{</span>
          <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;NONE&#34;</span>
        <span style="color:#f92672">}</span>,
        <span style="color:#e6db74">&#34;fingerprint&#34;</span>: <span style="color:#e6db74">&#34;5fdec309&#34;</span>,
        <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;dzkmxcgu&#34;</span>,
        <span style="color:#e6db74">&#34;satisfaction&#34;</span>: <span style="color:#f92672">{</span>
          <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;NONE&#34;</span>
        <span style="color:#f92672">}</span>,
        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;SIGNATURE&#34;</span>
      <span style="color:#f92672">}</span>,
      <span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;contribution&#34;</span>: <span style="color:#f92672">{</span>
          <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;NONE&#34;</span>
        <span style="color:#f92672">}</span>,
        <span style="color:#e6db74">&#34;fingerprint&#34;</span>: <span style="color:#e6db74">&#34;de41e56d&#34;</span>,
        <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;ekfu5uaw&#34;</span>,
        <span style="color:#e6db74">&#34;satisfaction&#34;</span>: <span style="color:#f92672">{</span>
          <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;NONE&#34;</span>
        <span style="color:#f92672">}</span>,
        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;SIGNATURE&#34;</span>
      <span style="color:#f92672">}</span>,
      <span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;contribution&#34;</span>: <span style="color:#f92672">{</span>
          <span style="color:#e6db74">&#34;condition&#34;</span>: <span style="color:#f92672">{</span>
            <span style="color:#e6db74">&#34;csv&#34;</span>: <span style="color:#ae81ff">2</span>
          <span style="color:#f92672">}</span>,
          <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;COMPLETE&#34;</span>
        <span style="color:#f92672">}</span>,
        <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;8kel7sdw&#34;</span>,
        <span style="color:#e6db74">&#34;satisfaction&#34;</span>: <span style="color:#f92672">{</span>
          <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;NONE&#34;</span>
        <span style="color:#f92672">}</span>,
        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;RELATIVETIMELOCK&#34;</span>,
        <span style="color:#e6db74">&#34;value&#34;</span>: <span style="color:#ae81ff">2</span>
      <span style="color:#f92672">}</span>
    <span style="color:#f92672">]</span>,
    <span style="color:#e6db74">&#34;satisfaction&#34;</span>: <span style="color:#f92672">{</span>
      <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;NONE&#34;</span>
    <span style="color:#f92672">}</span>,
    <span style="color:#e6db74">&#34;threshold&#34;</span>: 3,
    <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;THRESH&#34;</span>
  <span style="color:#f92672">}</span>,
  <span style="color:#e6db74">&#34;internal&#34;</span>: null
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="step-5a-create-spending-transaction">Step 5a: Create spending transaction</h3>
<p>The transaction can also be created by Alice, Bob, or Carol, or even an untrusted coordinator that only has all three tpubs.</p>
<p>Note that the argument provided to the &ndash;external_policy flag contains the id retrieved from the <code>policies</code> subcommand in the above step, in this case <code>ydtnup84</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bdk-cli wallet -w alice -d $ALICE_DESCRIPTOR create_tx -a --to tb1qm5tfegjevj27yvvna9elym9lnzcf0zraxgl8z2:0 --external_policy <span style="color:#e6db74">&#34;{\&#34;ydtnup84\&#34;: [0,1,2]}&#34;</span>
<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;details&#34;</span>: <span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;fees&#34;</span>: 169,
    <span style="color:#e6db74">&#34;height&#34;</span>: null,
    <span style="color:#e6db74">&#34;received&#34;</span>: 0,
    <span style="color:#e6db74">&#34;sent&#34;</span>: 10000,
    <span style="color:#e6db74">&#34;timestamp&#34;</span>: 1614058791,
    <span style="color:#e6db74">&#34;transaction&#34;</span>: null,
    <span style="color:#e6db74">&#34;txid&#34;</span>: <span style="color:#e6db74">&#34;3b9a7ac610afc91f1d1a0dd844e609376278fe7210c69b7ef663c5a8e8308f3e&#34;</span>
  <span style="color:#f92672">}</span>,
  <span style="color:#e6db74">&#34;psbt&#34;</span>: <span style="color:#e6db74">&#34;cHNidP8BAFIBAAAAAYx7T0cL7EoUYBEU0mSL6+DS4VQafUzJgAf0Ftlbkya5AQAAAAD/////AWcmAAAAAAAAFgAU3RacollkleIxk+lz8my/mLCXiH0AAAAAAAEBKxAnAAAAAAAAIgAgCBH16JNfSPhmjJR75EdDB+gSCEF7tStNOLqw/k3BvA0BBXchA3c1Ak2kcGOzOh6eRXFKfpnpzP1lzfcXIYhxFGZG51mxrHwhA75YDXRLDLt+eX5UsE03mIGUSsQP2MrJ9lm17cGXDw2mrJN8IQIvNjaP+mwNC0DtgaB6ENB/DPPlbUDR6+NZ4Sw070jzOKyTfHZjUrJpaJNThyIGAi82No/6bA0LQO2BoHoQ0H8M8+VtQNHr41nhLDTvSPM4DO66tnIAAAAAAAAAACIGA3c1Ak2kcGOzOh6eRXFKfpnpzP1lzfcXIYhxFGZG51mxGFrbRoNUAACAAQAAgAAAAIAAAAAAAAAAACIGA75YDXRLDLt+eX5UsE03mIGUSsQP2MrJ9lm17cGXDw2mDEMxpeYAAAAAAAAAAAAA&#34;</span>
<span style="color:#f92672">}</span>

export UNSIGNED_PSBT<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>bdk-cli wallet -w alice -d $ALICE_DESCRIPTOR create_tx -a --to tb1qm5tfegjevj27yvvna9elym9lnzcf0zraxgl8z2:0 --external_policy <span style="color:#e6db74">&#34;{\&#34;ydtnup84\&#34;: [0,1,2]}&#34;</span> | jq -r <span style="color:#e6db74">&#34;.psbt&#34;</span><span style="color:#66d9ef">)</span>
</code></pre></div><h3 id="step-6a-sign-and-finalize-psbts">Step 6a: Sign and finalize PSBTs</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># ALICE SIGNS</span>
export ALICE_SIGNED_PSBT<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>bdk-cli wallet -w alice -d $ALICE_DESCRIPTOR sign --psbt $UNSIGNED_PSBT | jq -r <span style="color:#e6db74">&#34;.psbt&#34;</span><span style="color:#66d9ef">)</span>

<span style="color:#75715e"># BOB SIGNS</span>
export ALICE_BOB_SIGNED_PSBT<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>bdk-cli wallet -w bob -d $BOB_DESCRIPTOR sign --psbt $ALICE_SIGNED_PSBT | jq -r <span style="color:#e6db74">&#34;.psbt&#34;</span><span style="color:#66d9ef">)</span>

<span style="color:#75715e"># CAROL SIGNS</span>
export FINAL_PSBT<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>bdk-cli wallet -w carol -d $CAROL_DESCRIPTOR sign --psbt $ALICE_BOB_SIGNED_PSBT | jq -r <span style="color:#e6db74">&#34;.psbt&#34;</span><span style="color:#66d9ef">)</span>

<span style="color:#75715e">## PSBT is finalized</span>
bdk-cli wallet -w carol -d $CAROL_DESCRIPTOR sign --psbt $ALICE_BOB_SIGNED_PSBT
<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;is_finalized&#34;</span>: true,
  <span style="color:#e6db74">&#34;psbt&#34;</span>: <span style="color:#e6db74">&#34;cHNidP8BAFIBAAAAAYx7T0cL7EoUYBEU0mSL6+DS4VQafUzJgAf0Ftlbkya5AQAAAAD/////AWcmAAAAAAAAFgAU3RacollkleIxk+lz8my/mLCXiH0AAAAAAAEBKxAnAAAAAAAAIgAgCBH16JNfSPhmjJR75EdDB+gSCEF7tStNOLqw/k3BvA0iAgIvNjaP+mwNC0DtgaB6ENB/DPPlbUDR6+NZ4Sw070jzOEcwRAIgRPXSwFLfzD1YQzw5FGYA0TgiQ+D88hSOVDbvyUZDiPUCIAbguaSGgCbBAXo5sIxpZ4c1dcGkYyrrqnDjc1jcdJ1CASICA3c1Ak2kcGOzOh6eRXFKfpnpzP1lzfcXIYhxFGZG51mxSDBFAiEA0kdkvlA+k5kUBWVUM8SkR4Ua9pnXF66ECVwIM1l0doACIF0aMiORVC35+M3GHF2Vl8Q7t455mebrr1HuLaAyxBOYASICA75YDXRLDLt+eX5UsE03mIGUSsQP2MrJ9lm17cGXDw2mRzBEAiBPJlQEnuVDHgfgOdTZNlIcRZz2iqHoMWfDmLMFqJSOQAIgCuOcTKp/VaaqwIjnYfMKO3eQ1k9pOygSWt6teT1o13QBAQV3IQN3NQJNpHBjszoenkVxSn6Z6cz9Zc33FyGIcRRmRudZsax8IQO+WA10Swy7fnl+VLBNN5iBlErED9jKyfZZte3Blw8NpqyTfCECLzY2j/psDQtA7YGgehDQfwzz5W1A0evjWeEsNO9I8zisk3x2Y1KyaWiTU4ciBgIvNjaP+mwNC0DtgaB6ENB/DPPlbUDR6+NZ4Sw070jzOBjeQeVtVAAAgAEAAIAAAACAAAAAAAAAAAAiBgN3NQJNpHBjszoenkVxSn6Z6cz9Zc33FyGIcRRmRudZsQwpbm6KAAAAAAAAAAAiBgO+WA10Swy7fnl+VLBNN5iBlErED9jKyfZZte3Blw8NpgxDMaXmAAAAAAAAAAABBwABCP1TAQUARzBEAiBE9dLAUt/MPVhDPDkUZgDROCJD4PzyFI5UNu/JRkOI9QIgBuC5pIaAJsEBejmwjGlnhzV1waRjKuuqcONzWNx0nUIBRzBEAiBPJlQEnuVDHgfgOdTZNlIcRZz2iqHoMWfDmLMFqJSOQAIgCuOcTKp/VaaqwIjnYfMKO3eQ1k9pOygSWt6teT1o13QBSDBFAiEA0kdkvlA+k5kUBWVUM8SkR4Ua9pnXF66ECVwIM1l0doACIF0aMiORVC35+M3GHF2Vl8Q7t455mebrr1HuLaAyxBOYAXchA3c1Ak2kcGOzOh6eRXFKfpnpzP1lzfcXIYhxFGZG51mxrHwhA75YDXRLDLt+eX5UsE03mIGUSsQP2MrJ9lm17cGXDw2mrJN8IQIvNjaP+mwNC0DtgaB6ENB/DPPlbUDR6+NZ4Sw070jzOKyTfHZjUrJpaJNThwAA&#34;</span>
</code></pre></div><h3 id="step-7a-broadcast-finalized-psbt">Step 7a: Broadcast finalized PSBT</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bdk-cli wallet -w carol -d $CAROL_DESCRIPTOR broadcast --psbt $FINAL_PSBT
<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;txid&#34;</span>: <span style="color:#e6db74">&#34;3b9a7ac610afc91f1d1a0dd844e609376278fe7210c69b7ef663c5a8e8308f3e&#34;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="step-8a-confirm-transaction-included-in-a-testnet-block">Step 8a: Confirm transaction included in a testnet block</h3>
<p><a href="https://mempool.space/testnet/tx/3b9a7ac610afc91f1d1a0dd844e609376278fe7210c69b7ef663c5a8e8308f3e">https://mempool.space/testnet/tx/3b9a7ac610afc91f1d1a0dd844e609376278fe7210c69b7ef663c5a8e8308f3e</a></p>
<p>And new wallet balance is now zero.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bdk-cli wallet -w alice -d $ALICE_DESCRIPTOR sync
<span style="color:#f92672">{}</span>
bdk-cli wallet -w alice -d $ALICE_DESCRIPTOR get_balance
<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;satoshi&#34;</span>: <span style="color:#ae81ff">0</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="done">DONE!</h3>
<h2 id="policy-b-two-signatures-after-a-relative-time-lock">Policy B. Two signatures after a relative time lock</h2>
<p>Now we will use the same extended private and public keys, and the same descriptors to receive and spend testnet bitcoin using only two of our participants signatures after the transaction input&rsquo;s relative time-lock has expired.</p>
<h3 id="step-1b-create-a-new-testnet-receive-address">Step 1b: Create a new testnet receive address</h3>
<p>The receive address can still be generated by Alice, Bob, or Carol.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bdk-cli wallet -w alice -d $ALICE_DESCRIPTOR get_new_address
<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;address&#34;</span>: <span style="color:#e6db74">&#34;tb1q886w2zmtakwxpngs9kn7y0a7tvd6e24u58sse2sv92zrjpnenfhqtfnmw9&#34;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="step-2b-fund-new-address-from-testnet-faucet">Step 2b: Fund new address from testnet faucet</h3>
<p>After the faucet payment is sent, confirm using a testnet block explorer to verify the transaction was included in a block.</p>
<p><a href="https://mempool.space/testnet/address/tb1q886w2zmtakwxpngs9kn7y0a7tvd6e24u58sse2sv92zrjpnenfhqtfnmw9">https://mempool.space/testnet/address/tb1q886w2zmtakwxpngs9kn7y0a7tvd6e24u58sse2sv92zrjpnenfhqtfnmw9</a></p>
<h3 id="step-3b-sync-wallet-and-confirm-wallet-balance">Step 3b: Sync wallet and confirm wallet balance</h3>
<p>This step must be done by Alice and Bob so their individual descriptor wallets know about the faucet transaction they will later be spending the output of.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bdk-cli wallet -w alice -d $ALICE_DESCRIPTOR sync       
<span style="color:#f92672">{}</span>
bdk-cli wallet -w alice -d $ALICE_DESCRIPTOR get_balance
<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;satoshi&#34;</span>: <span style="color:#ae81ff">10000</span>
<span style="color:#f92672">}</span>

bdk-cli wallet -w bob -d $BOB_DESCRIPTOR sync       
<span style="color:#f92672">{}</span>
bdk-cli wallet -w bob -d $BOB_DESCRIPTOR get_balance
<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;satoshi&#34;</span>: <span style="color:#ae81ff">10000</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e"># NO CAROL SHE LOST HER KEY!</span>
</code></pre></div><h3 id="step-4b-create-spending-transaction">Step 4b: Create spending transaction</h3>
<p>This spending transaction uses Alice and Bob&rsquo;s keys plus a two block relative time-lock, see above <a href="#step-4a-view-wallet-spending-policies">Step 4a</a> for the policy id. The transaction can be created by Alice or Bob.</p>
<p>A time based relative time-lock can be used instead of one based on blocks but is slightly more complicated to calculate. See
<a href="https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki#specification">BIP-68</a> for the details.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bdk-cli wallet -w alice -d $ALICE_DESCRIPTOR create_tx -a --to tb1qm5tfegjevj27yvvna9elym9lnzcf0zraxgl8z2:0 --external_policy <span style="color:#e6db74">&#34;{\&#34;ydtnup84\&#34;: [0,1,3]}&#34;</span>
<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;details&#34;</span>: <span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;fees&#34;</span>: 169,
    <span style="color:#e6db74">&#34;height&#34;</span>: null,
    <span style="color:#e6db74">&#34;received&#34;</span>: 0,
    <span style="color:#e6db74">&#34;sent&#34;</span>: 10000,
    <span style="color:#e6db74">&#34;timestamp&#34;</span>: 1614059434,
    <span style="color:#e6db74">&#34;transaction&#34;</span>: null,
    <span style="color:#e6db74">&#34;txid&#34;</span>: <span style="color:#e6db74">&#34;6a04c60dff8eeb14dc0848c663d669c34ddc30125d9564364c9414e3ff4a7d28&#34;</span>
  <span style="color:#f92672">}</span>,
  <span style="color:#e6db74">&#34;psbt&#34;</span>: <span style="color:#e6db74">&#34;cHNidP8BAFICAAAAAYmc6mhj4Cf4pcJyBvxSbCd9IB1yDGs+plzb95t7++v0AAAAAAACAAAAAWcmAAAAAAAAFgAU3RacollkleIxk+lz8my/mLCXiH0AAAAAAAEBKxAnAAAAAAAAIgAgOfTlC2vtnGDNEC2n4j++Wxusqryh4QyqDCqEOQZ5mm4BBXchAlUVWMkNwGkCxDe4ZAcyz7HI+Vpmo4A5//OvkV33PCpprHwhAq9NOHBbPEdKr8IzYEomNTk1eokAkLQ9+ZMuS/OlX+nFrJN8IQOrU70B/wo/oUUCKFQ2cIsBxx6SysE7uVwxyu0ozM4zYqyTfHZjUrJpaJNThyIGAlUVWMkNwGkCxDe4ZAcyz7HI+Vpmo4A5//OvkV33PCppGFrbRoNUAACAAQAAgAAAAIAAAAAAAQAAACIGAq9NOHBbPEdKr8IzYEomNTk1eokAkLQ9+ZMuS/OlX+nFDEMxpeYAAAAAAQAAACIGA6tTvQH/Cj+hRQIoVDZwiwHHHpLKwTu5XDHK7SjMzjNiDO66tnIAAAAAAQAAAAAA&#34;</span>
<span style="color:#f92672">}</span>

export UNSIGNED_PSBT2<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>bdk-cli wallet -w alice -d $ALICE_DESCRIPTOR create_tx -a --to tb1qm5tfegjevj27yvvna9elym9lnzcf0zraxgl8z2:0 --external_policy <span style="color:#e6db74">&#34;{\&#34;ydtnup84\&#34;: [0,1,3]}&#34;</span> | jq -r <span style="color:#e6db74">&#34;.psbt&#34;</span><span style="color:#66d9ef">)</span>
</code></pre></div><h3 id="step-5b-sign-and-finalize-psbts">Step 5b: Sign and finalize PSBTs</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># ALICE SIGNS</span>
export ALICE_SIGNED_PSBT2<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>bdk-cli wallet -w alice -d $ALICE_DESCRIPTOR sign --psbt $UNSIGNED_PSBT2 | jq -r <span style="color:#e6db74">&#34;.psbt&#34;</span><span style="color:#66d9ef">)</span>

<span style="color:#75715e"># BOB SIGNS</span>
export FINAL_PSBT2<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>bdk-cli wallet -w bob -d $BOB_DESCRIPTOR sign --psbt $ALICE_SIGNED_PSBT2 | jq -r <span style="color:#e6db74">&#34;.psbt&#34;</span><span style="color:#66d9ef">)</span>

<span style="color:#75715e"># CAROL DOES *NOT* SIGN</span>
</code></pre></div><h3 id="step-6b-broadcast-finalized-psbt">Step 6b: Broadcast finalized PSBT</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bdk-cli wallet -w bob -d $BOB_DESCRIPTOR broadcast --psbt $FINAL_PSBT2
thread <span style="color:#e6db74">&#39;main&#39;</span> panicked at <span style="color:#e6db74">&#39;called `Result::unwrap()` on an `Err` value: Electrum(Protocol(String(&#34;sendrawtransaction RPC error: {\&#34;code\&#34;:-26,\&#34;message\&#34;:\&#34;non-BIP68-final\&#34;}&#34;)))&#39;</span>, src/bdk_cli.rs:168:50

<span style="color:#75715e"># Oops we didn&#39;t wait long enough for the relative time lock to expire</span>

<span style="color:#75715e"># Try again in ~20 mins and it is successfully broadcast</span>

bdk-cli wallet -w bob -d $BOB_DESCRIPTOR broadcast --psbt $FINAL_PSBT2          
<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;txid&#34;</span>: <span style="color:#e6db74">&#34;6a04c60dff8eeb14dc0848c663d669c34ddc30125d9564364c9414e3ff4a7d28&#34;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="step-7b-view-confirmed-transaction">Step 7b: View confirmed transaction</h3>
<p><a href="https://mempool.space/testnet/tx/6a04c60dff8eeb14dc0848c663d669c34ddc30125d9564364c9414e3ff4a7d28">https://mempool.space/testnet/tx/6a04c60dff8eeb14dc0848c663d669c34ddc30125d9564364c9414e3ff4a7d28</a></p>
<p>And wallet balance is again zero</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bdk-cli wallet -w alice -d $ALICE_DESCRIPTOR sync
<span style="color:#f92672">{}</span>
bdk-cli wallet -w alice -d $ALICE_DESCRIPTOR get_balance
<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;satoshi&#34;</span>: <span style="color:#ae81ff">0</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="done-again">Done again!</h3>
<p>In this demo we showed how to receive and spend bitcoin using two different descriptor wallet policies using the <code>bdk</code> library and <code>bdk-cli</code> wallet tool.</p>


<footer class="footline">
	
</footer>

        
        </div>
        

<script src="https://utteranc.es/client.js"
        repo="bitcoindevkit/blog-comments"
        issue-term="pathname"
        label="blog-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>



      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1621379878"></script>
    <script src="/js/perfect-scrollbar.min.js?1621379878"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1621379878"></script>
    <script src="/js/jquery.sticky.js?1621379878"></script>
    <script src="/js/featherlight.min.js?1621379878"></script>
    <script src="/js/highlight.pack.js?1621379878"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1621379878"></script>
    <script src="/js/learn.js?1621379878"></script>
    <script src="/js/hugo-learn.js?1621379878"></script>
    
        
            <script src="/mermaid/mermaid.js?1621379878"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    <script type="text/javascript" src="/js/jsonview.js" charset="utf-8"></script>
<script type="text/javascript" src="/js/main.js" charset="utf-8"></script>

  </body>
</html>

